#ifndef lint
static char sccsid[] = "@(#)imageinfoui.c 1.8 95/02/02";
#endif

/*
 * Copyright 1993 Sun Microsystems, Inc.  All rights reserved.
 */

/*
 * imageinfoui.c - User interface object initialization functions
 * for image info pop up.
 * This file was generated by `gxv' from `imagetool.G'.
 */

#include <Xm/Xm.h>
#include <Xm/DialogS.h>
#include <Xm/Form.h>
#include <Xm/Label.h>
#include <Xm/MessageB.h>
#include <Xm/PushB.h>
#include <Xm/Text.h>

#include "help.h"
#include "image.h"
#include "imagetool.h"
#include "display.h"
#include "ui_imagetool.h"

/*
 * Initialize an instance of object `imageinfo'.
 */
InfoObjects *
InfoObjectsInitialize(parent)
     Widget parent;
{
     Widget          children[16];     /* Children to manage */
     Arg             al[64];           /* Arg List */
     register int    ac = 0;           /* Arg Count */
     XmString        xmstrings[16];    /* temporary storage for XmStrings */
     InfoObjects    *i;
     Widget          form, longest_label;
     Dimension       width1, width2, width3, width4, width5, 
     longest, height;
     Pixel           bg;
     XmTextScanType  selArray[1];
     
     extern void   PopupEventHandler();
     extern void   ImageInfoCancelCallback();
     
     i = (InfoObjects *) calloc (1, sizeof (InfoObjects));
/*
 * Create Shell, Dialog, Forms.
 */	
     ac = 0;
     XtSetArg(al[ac], XmNallowShellResize, TRUE); ac++;
     XtSetArg(al[ac], XmNtitle, catgets (prog->catd, 1, 80, 
			        "Image Viewer - Image Information")); ac++;
     i->shell = XmCreateDialogShell ( parent, "ImageInfoShell", al, ac );
/*
 * Create Message Dialog Box
 */
     ac = 0;
     XtSetArg(al[ac], XmNautoUnmanage, FALSE); ac++;
     XtSetArg(al[ac], XmNdialogType, XmDIALOG_TEMPLATE); ac++;	
     XtSetArg(al[ac], XmNnoResize, FALSE); ac++;
     i->dialog = XmCreateMessageBox (i->shell, "ImageInfoDialog", al, ac );
/*
 * Add event handler to catch Maps/Unmaps.
 */
     XtAddEventHandler (i->shell, StructureNotifyMask, False,
			PopupEventHandler, i->dialog);
/*
 * Create Form
 */
     ac = 0;
     XtSetArg(al[ac], XmNautoUnmanage, FALSE); ac++;
     XtSetArg(al[ac], XmNfractionBase, 6); ac++;
     form = XmCreateForm ( i->dialog, "ImageInfoForm", al, ac );
/*
 * Create Height Label
 */
     ac = 0;
     xmstrings[0] = XmStringCreateLocalized (catgets (prog->catd, 1, 81,
						      "Height:"));
     XtSetArg(al[ac], XmNlabelString, xmstrings[0]); ac++;
     XtSetArg(al[ac], XmNtopAttachment, XmATTACH_POSITION); ac++;
     XtSetArg(al[ac], XmNtopPosition, 0); ac++;
     i->height_label = XmCreateLabel ( form, "HeightLabel", al, ac );
     XmStringFree ( xmstrings [ 0 ] );
/*
 * Create Width Label
 */
     ac = 0;
     xmstrings[0] = XmStringCreateLocalized (catgets (prog->catd, 1, 82,
						      "Width:"));
     XtSetArg(al[ac], XmNlabelString, xmstrings[0]); ac++;
     XtSetArg(al[ac], XmNtopAttachment, XmATTACH_POSITION); ac++;
     XtSetArg(al[ac], XmNtopPosition, 1); ac++; 
     i->width_label = XmCreateLabel ( form, "WidthLabel", al, ac );
     XmStringFree ( xmstrings [ 0 ] );
/*
 * Create Colors Label
 */
     ac = 0;
     xmstrings[0] = XmStringCreateLocalized (catgets (prog->catd, 1, 83,
						      "Colors:"));
     XtSetArg(al[ac], XmNlabelString, xmstrings[0]); ac++;
     XtSetArg(al[ac], XmNtopAttachment, XmATTACH_POSITION); ac++;
     XtSetArg(al[ac], XmNtopPosition, 2); ac++;
     i->colors_label = XmCreateLabel ( form, "ColorsLabel", al, ac );
     XmStringFree ( xmstrings [ 0 ] );
/*
 * Create Size Label
 */
     ac = 0;
     xmstrings[0] = XmStringCreateLocalized (catgets (prog->catd, 1, 84, 
						      "File Size:"));
     XtSetArg(al[ac], XmNlabelString, xmstrings[0]); ac++;
     XtSetArg(al[ac], XmNtopAttachment, XmATTACH_POSITION); ac++;
     XtSetArg(al[ac], XmNtopPosition, 4); ac++;
     i->size_label = XmCreateLabel ( form, "SizeLabel", al, ac );
     XmStringFree ( xmstrings [ 0 ] );
/*
 * Create Format Label
 */
     ac = 0;
     xmstrings[0] = XmStringCreateLocalized (catgets (prog->catd, 1, 85,
						      "File Format:"));
     XtSetArg(al[ac], XmNlabelString, xmstrings[0]); ac++;
     XtSetArg(al[ac], XmNtopAttachment, XmATTACH_POSITION); ac++;
     XtSetArg(al[ac], XmNtopPosition, 5); ac++; 
     i->format_label = XmCreateLabel ( form, "FormatLabel", al, ac );
     XmStringFree ( xmstrings [ 0 ] );
/*
 * Find longest label
 */
     XtVaGetValues (i->height_label, XmNwidth, &width1, NULL);
     XtVaGetValues (i->width_label, XmNwidth, &width2, NULL);
     XtVaGetValues (i->colors_label, XmNwidth, &width3, NULL);
     XtVaGetValues (i->size_label, XmNwidth, &width4, NULL);
     XtVaGetValues (i->format_label, XmNwidth, &width5, NULL);
     
     longest = width1;
     longest_label = i->height_label;
     
     if (width2 > longest) {
       longest = width2;
       longest_label = i->width_label;
     }
     if (width3 > longest){
       longest = width3;
       longest_label = i->colors_label;
     }
     if (width4 > longest) {
       longest = width4;
       longest_label = i->size_label;
     }
     if (width5 > longest) {
       longest = width5;
       longest_label = i->format_label;
     }
/*
 * Now that we know which label is the longest,
 * align the other labels with this label.
 */
     if (i->height_label != longest_label) 
       XtVaSetValues (i->height_label, 
		      XmNrightAttachment, XmATTACH_OPPOSITE_WIDGET,
		      XmNrightWidget, longest_label, 
		      NULL);
     if (i->width_label != longest_label) 
       XtVaSetValues (i->width_label, 
		      XmNrightAttachment, XmATTACH_OPPOSITE_WIDGET,
		      XmNrightWidget, longest_label, 
		      NULL);
     if (i->colors_label != longest_label)
       XtVaSetValues (i->colors_label, 
		      XmNrightAttachment, XmATTACH_OPPOSITE_WIDGET,
		      XmNrightWidget, longest_label, 
		      NULL);
     if (i->size_label != longest_label)
       XtVaSetValues (i->size_label, 
		      XmNrightAttachment, XmATTACH_OPPOSITE_WIDGET,
		      XmNrightWidget, longest_label, 
		      NULL);
     if (i->format_label != longest_label)
       XtVaSetValues (i->format_label, 
		      XmNrightAttachment, XmATTACH_OPPOSITE_WIDGET,
		      XmNrightWidget, longest_label, 
		      NULL);
/*
 * Create Height Value
 */
     XtVaGetValues (form, XmNbackground, &bg, NULL);
     ac = 0;
     XtSetArg(al[ac], XmNtopAttachment, XmATTACH_POSITION); ac++;
     XtSetArg(al[ac], XmNtopPosition, 0); ac++; 	
     XtSetArg(al[ac], XmNleftAttachment, XmATTACH_WIDGET); ac++;
     XtSetArg(al[ac], XmNleftWidget, i->height_label); ac++;
     XtSetArg(al[ac], XmNleftOffset, 10); ac++;
     XtSetArg(al[ac], XmNshadowThickness, 0); ac++;
     XtSetArg(al[ac], XmNeditable, False); ac++;
     XtSetArg(al[ac], XmNcursorPositionVisible, False); ac++;	
     XtSetArg(al[ac], XmNtraversalOn, False); ac++;
     XtSetArg(al[ac], XmNbackground, bg); ac++;
     XtSetArg(al[ac], XmNresizeWidth, True); ac++;
     XtSetArg(al[ac], XmNresizeHeight, False); ac++;
     XtSetArg(al[ac], XmNselectionArray, selArray); ac++;
     XtSetArg(al[ac], XmNselectionArrayCount, 0); ac++;
     i->height = XmCreateText ( form, "HeightValue", al, ac );
/*
 * Create Width Value
 */
     ac = 0;
     XtSetArg(al[ac], XmNtopAttachment, XmATTACH_POSITION); ac++;
     XtSetArg(al[ac], XmNtopPosition, 1); ac++;
     XtSetArg(al[ac], XmNleftAttachment, XmATTACH_WIDGET); ac++;
     XtSetArg(al[ac], XmNleftWidget, i->width_label); ac++;
     XtSetArg(al[ac], XmNleftOffset, 10); ac++;
     XtSetArg(al[ac], XmNshadowThickness, 0); ac++;
     XtSetArg(al[ac], XmNeditable, False); ac++;
     XtSetArg(al[ac], XmNcursorPositionVisible, False); ac++;	
     XtSetArg(al[ac], XmNtraversalOn, False); ac++;
     XtSetArg(al[ac], XmNbackground, bg); ac++;
     XtSetArg(al[ac], XmNresizeWidth, True); ac++;
     XtSetArg(al[ac], XmNresizeHeight, False); ac++;
     XtSetArg(al[ac], XmNselectionArray, selArray); ac++;
     XtSetArg(al[ac], XmNselectionArrayCount, 0); ac++;
     i->width = XmCreateText ( form, "WidthValue", al, ac );
/*
 * Create Colors Value
 */
     ac = 0;
     XtSetArg(al[ac], XmNtopAttachment, XmATTACH_POSITION); ac++;
     XtSetArg(al[ac], XmNtopPosition, 2); ac++;
     XtSetArg(al[ac], XmNleftAttachment, XmATTACH_WIDGET); ac++;
     XtSetArg(al[ac], XmNleftWidget, i->colors_label); ac++;
     XtSetArg(al[ac], XmNleftOffset, 10); ac++;	
     XtSetArg(al[ac], XmNshadowThickness, 0); ac++;
     XtSetArg(al[ac], XmNeditable, False); ac++;
     XtSetArg(al[ac], XmNcursorPositionVisible, False); ac++;	
     XtSetArg(al[ac], XmNtraversalOn, False); ac++;
     XtSetArg(al[ac], XmNbackground, bg); ac++;
     XtSetArg(al[ac], XmNresizeWidth, True); ac++;
     XtSetArg(al[ac], XmNresizeHeight, False); ac++;
     XtSetArg(al[ac], XmNselectionArray, selArray); ac++;
     XtSetArg(al[ac], XmNselectionArrayCount, 0); ac++;
     i->colors = XmCreateText ( form, "ColorsValue", al, ac );
/*
 * Create Size Value
 */
     ac = 0;
     XtSetArg(al[ac], XmNtopAttachment, XmATTACH_POSITION); ac++;
     XtSetArg(al[ac], XmNtopPosition, 4); ac++;
     XtSetArg(al[ac], XmNleftAttachment, XmATTACH_WIDGET); ac++;
     XtSetArg(al[ac], XmNleftWidget, i->colors_label); ac++;
     XtSetArg(al[ac], XmNleftOffset, 10); ac++;	
     XtSetArg(al[ac], XmNshadowThickness, 0); ac++;
     XtSetArg(al[ac], XmNeditable, False); ac++;
     XtSetArg(al[ac], XmNcursorPositionVisible, False); ac++;	
     XtSetArg(al[ac], XmNtraversalOn, False); ac++;
     XtSetArg(al[ac], XmNbackground, bg); ac++;
     XtSetArg(al[ac], XmNresizeWidth, True); ac++;
     XtSetArg(al[ac], XmNresizeHeight, False); ac++;
     XtSetArg(al[ac], XmNselectionArray, selArray); ac++;
     XtSetArg(al[ac], XmNselectionArrayCount, 0); ac++;
     i->size = XmCreateText ( form, "SizeValue", al, ac );
/*
 * Create Format Value
 */
     ac = 0;
     XtSetArg(al[ac], XmNtopAttachment, XmATTACH_POSITION); ac++;
     XtSetArg(al[ac], XmNtopPosition, 5); ac++; 
     XtSetArg(al[ac], XmNleftAttachment, XmATTACH_WIDGET); ac++;
     XtSetArg(al[ac], XmNleftWidget, i->format_label); ac++;
     XtSetArg(al[ac], XmNleftOffset, 10); ac++;
     XtSetArg(al[ac], XmNshadowThickness, 0); ac++;
     XtSetArg(al[ac], XmNeditable, False); ac++;
     XtSetArg(al[ac], XmNcursorPositionVisible, False); ac++;	
     XtSetArg(al[ac], XmNtraversalOn, False); ac++;
     XtSetArg(al[ac], XmNbackground, bg); ac++;
     XtSetArg(al[ac], XmNresizeWidth, True); ac++;
     XtSetArg(al[ac], XmNresizeHeight, False); ac++;
     XtSetArg(al[ac], XmNselectionArray, selArray); ac++;
     XtSetArg(al[ac], XmNselectionArrayCount, 0); ac++;
     i->format = XmCreateText ( form, "FormatValue", al, ac );
/*
 * Adjust the labels to align with bottom of text, not top.
 */
     XtVaGetValues (i->height, XmNheight, &height, NULL);
     XtVaSetValues (i->height_label, XmNtopOffset, (int) (height / 15), NULL);
     XtVaSetValues (i->width_label, XmNtopOffset, (int) (height / 15), NULL);
     XtVaSetValues (i->colors_label, XmNtopOffset, (int) (height / 15), NULL);
     XtVaSetValues (i->size_label, XmNtopOffset, (int) (height / 15), NULL);
     XtVaSetValues (i->format_label, XmNtopOffset, (int) (height / 15), NULL);
/*
 * Create Cancel Button
 */
     ac = 0;
     xmstrings[0] = XmStringCreateLocalized (catgets (prog->catd, 1, 86, 
						      "Close"));
     XtSetArg(al[ac], XmNlabelString, xmstrings[0]); ac++;
     i->cancel_button = XmCreatePushButton (i->dialog, "PaletteCancelButton", 
					    al, ac );
     XmStringFree ( xmstrings [ 0 ] );
/*
 * Create Help Button
 */
     ac = 0;
     xmstrings[0] = XmStringCreateLocalized (catgets (prog->catd, 1, 87, 
						      "Help"));
     XtSetArg(al[ac], XmNlabelString, xmstrings[0]); ac++;
     i->help_button = XmCreatePushButton ( i->dialog, "PaletteHelpButton", 
					  al, ac );
     XmStringFree ( xmstrings [ 0 ] );
/*
 * Set Cancel to be default button.
 */
     XtVaSetValues (i->dialog, XmNdefaultButton, i->cancel_button, NULL);
     
     i->showing = False;
/*
 * Set help callback on dialog
 */
     XtAddCallback (i->dialog, XmNhelpCallback, HelpItemCallback, 
		    HELP_IMAGEINFO_ITEM);
/*
 * Set callbacks on buttons
 */
     XtAddCallback (i->cancel_button, XmNactivateCallback, 
		    ImageInfoCancelCallback, i);
     XtAddCallback (i->help_button, XmNactivateCallback, HelpItemCallback, 
		    HELP_IMAGEINFO_ITEM);
/*
 * Manage the children
 */
     ac = 0;
     children[ac++] = i->height_label;
     children[ac++] = i->width_label;
     children[ac++] = i->colors_label;
     children[ac++] = i->size_label;
     children[ac++] = i->format_label;
     children[ac++] = i->height;
     children[ac++] = i->width;
     children[ac++] = i->colors;
     children[ac++] = i->size;
     children[ac++] = i->format;
     XtManageChildren(children, ac);
     ac = 0;
     children[ac++] = form;
     children[ac++] = i->cancel_button;
     children[ac++] = i->help_button;
     XtManageChildren(children, ac);
     
     return i;

}

void
update_imageinfo(image)
ImageInfo	*image;
{
    char  	s[256];
 
    if (image == (ImageInfo *) NULL)
       return;
 
    sprintf ( s, catgets (prog->catd, 1, 88, "%.1f in / %.1f cm / %d pix"), 
		(float) image->height / current_display->res_y, 
		(float) image->height / current_display->res_y * 2.54,
		image->height);
    XmTextSetString (info->height, s);

    sprintf ( s, catgets (prog->catd, 1, 89, "%.1f in / %.1f cm / %d pix"), 
		(float) image->width / current_display->res_x, 
		(float) image->width / current_display->res_x * 2.54, image->width);
    XmTextSetString (info->width, s);

    if (image->colors != 0)
       sprintf ( s, catgets (prog->catd, 1, 90, "%d colors"), image->colors);
    else if (image->depth >= 24)
       sprintf ( s, catgets (prog->catd, 1, 91, "Millions of colors"));
    else 
       sprintf ( s, catgets (prog->catd, 1, 92, "N/A"));

    XmTextSetString (info->colors, s);

    XmTextSetString (info->format, (image->type_info)->popup_list_name);

    if (image->file_size / 1000000 > 0)
       sprintf( s, catgets (prog->catd, 1, 93, "%.1f MBytes"), 
		   (float) image->file_size / 1000000.0);
    else if (image->file_size / 1000 > 0)
       sprintf( s, catgets (prog->catd, 1, 94, "%.1f KBytes"), 
		   (float) image->file_size / 1000.0);
    else
       sprintf( s, catgets (prog->catd, 1, 95, "%d Bytes"), image->file_size );

    XmTextSetString (info->size, s);

}

void
ImageInfoCancelCallback (w, client_data, call_data)
     Widget     w;
     XtPointer  client_data;
     XtPointer  call_data;
{
     InfoObjects *i = (InfoObjects *)client_data;

     XtPopdown (XtParent (i->dialog));
}

