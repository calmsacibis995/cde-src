#ifndef lint
static char sccsid[] = "@(#)paletteui.c 1.21 96/03/19";
#endif

/*
 * Copyright 1993 Sun Microsystems, Inc.  All rights reserved.
 */

/*
 * palette.c - User interface object initialization functions
 * for the palette pop up.
 * This file was generated by `gxv' from `imagetool.G'.
 */

#include <sys/param.h>
#include <Xm/Xm.h>
#include <Xm/DialogS.h>
#include <Xm/DrawnB.h>
#include <Xm/Form.h>
#include <Xm/Label.h>
#include <Xm/MessageB.h>
#include <Xm/PushB.h>
#include <Xm/Scale.h>
#include <Xm/SeparatoG.h>
#include <Dt/SpinBox.h>
#include <Dt/xpm.h>

#include "imagetool.h" 
#include "ui_imagetool.h"
#include "help.h"

#include "degrees.xbm"
#include "pan_cursor.xbm"
#include "pan_cursor_mask.xbm"


static void
CreatePalettePixmaps (PaletteObjects *p, Widget w)
{
    Pixel          fg, bg;
    Display       *dpy = XtDisplay (base->top_level);
    Screen        *s;
    Window         root;
    int            depth;
    static XImage  pan_image, select_image, vflip_image, hflip_image,
                   zoom_image, rotate_r_image, rotate_l_image, degrees_image;
    Status         status;
    
    XtVaGetValues (base->menu_bar, XmNforeground, &fg,
		                   XmNbackground, &bg, 
		                   XmNdepth, &depth, NULL);
    s = XtScreen (w);
    root = DefaultRootWindow (dpy);
    
    if (depth > 1) {
      p->pan_pixmap = XmGetPixmap (s, "SDtimage.move.m.pm", bg, fg); 
      p->select_pixmap = XmGetPixmap (s, "SDtimage.select.m.pm", bg, fg);
      p->vflip_pixmap = XmGetPixmap (s, "SDtimage.flipV.m.pm", bg, fg);
      p->hflip_pixmap = XmGetPixmap (s, "SDtimage.flipH.m.pm", bg, fg);
      p->rotate_r_pixmap = XmGetPixmap (s, "SDtimage.rotateR.m.pm", bg, fg);
      p->rotate_l_pixmap = XmGetPixmap (s, "SDtimage.rotateL.m.pm", bg, fg);
      p->zoom_pixmap = XmGetPixmap (s, "SDtimage.scale.m.pm", bg, fg); 
    }      
    else {
      p->pan_pixmap = XmGetPixmap (s, "SDtimage.move.m.bm", fg, bg);
      p->select_pixmap = XmGetPixmap (s, "SDtimage.select.m.bm", fg, bg);
      p->vflip_pixmap = XmGetPixmap (s, "SDtimage.flipH.m.bm", fg, bg);
      p->hflip_pixmap = XmGetPixmap (s, "SDtimage.flipV.m.bm", fg, bg);
      p->rotate_r_pixmap = XmGetPixmap (s, "SDtimage.rotateR.m.bm", fg, bg);
      p->rotate_l_pixmap = XmGetPixmap (s, "SDtimage.rotateL.m.bm", fg, bg);
      p->zoom_pixmap = XmGetPixmap (s, "SDtimage.scale.m.bm", fg, bg);
    }
/*
 * Need this for any depth.
 */
    p->degrees_pixmap = XCreatePixmapFromBitmapData(dpy, root, 
				(char *)degrees_xbm_bits, 
			   	degrees_xbm_width, degrees_xbm_height,
				fg, bg, depth);
}

/*
 * Initialize an instance of object `palette'.
 */
PaletteObjects *
PaletteObjectsInitialize(parent)
    Widget       parent;
{
    Widget        children[16];      /* Children to manage */
    Arg           al[64];            /* Arg List */
    register int  ac = 0;            /* Arg Count */
    Widget        form, sep1, sep2, percent_label, degrees_label;
    XmString      xmstrings[4];
    PaletteObjects   *p;
    extern void   PanCallback();
    extern void   SelectCallback();
    extern void   VflipCallback();
    extern void   HflipCallback();
    extern void   RotateCallback();
    extern void   RotateValueCallback();
    extern void   RotateScaleCallback();
    extern void   ZoomCallback();
    extern void   ZoomValueCallback();
    extern void   ZoomScaleCallback();
    extern void   RevertCallback();
    extern void   PopupEventHandler();
    extern void   PaletteCancelCallback();

    p = (PaletteObjects *) calloc(1, sizeof (PaletteObjects));
/*
 * Create Dialog Shell, Message Box, Form.
 */
    ac = 0;
    XtSetArg(al[ac], XmNtitle, 
	     catgets (prog->catd, 1, 145, "Image Viewer - Palette")); ac++;
    p->shell = XmCreateDialogShell ( parent, "PaletteShell", al, ac );
/*
 * Create Message Dialog Box
 */
    ac = 0;
    XtSetArg(al[ac], XmNautoUnmanage, FALSE); ac++;
    XtSetArg(al[ac], XmNdialogType, XmDIALOG_TEMPLATE); ac++;	
    XtSetArg(al[ac], XmNnoResize, TRUE); ac++;
    p->dialog = XmCreateMessageBox (p->shell, "PaletteDialog", al, ac );
/*
 * Add event handler to catch Maps/Unmaps.
 */
    XtAddEventHandler (p->shell, StructureNotifyMask, False,
		       PopupEventHandler, p->dialog);
/*
 * Create Form
 */
    ac = 0;
    XtSetArg(al[ac], XmNautoUnmanage, FALSE); ac++;
    XtSetArg(al[ac], XmNdialogType, XmDIALOG_TEMPLATE); ac++;	
    XtSetArg(al[ac], XmNnoResize, TRUE); ac++;
    XtSetArg(al[ac], XmNmarginWidth, 0); ac++;
    XtSetArg(al[ac], XmNmarginHeight, 0); ac++;
    XtSetArg(al[ac], XmNbottomOffset, 0); ac++;
    XtSetArg(al[ac], XmNtopOffset, 0); ac++;
    XtSetArg(al[ac], XmNleftOffset, 0); ac++;
    XtSetArg(al[ac], XmNrightOffset, 0); ac++;
    form = XmCreateForm ( p->dialog, "PaletteForm", al, ac );
/*
 * Create pixmaps used on palette
 */
    CreatePalettePixmaps (p, base->form);
/*
 * Create Pan Button
 */
    ac = 0;
    XtSetArg(al[ac], XmNlabelType, XmPIXMAP); ac++;
    XtSetArg(al[ac], XmNlabelPixmap, p->pan_pixmap); ac++;
    XtSetArg(al[ac], XmNshadowType, XmSHADOW_ETCHED_OUT); ac++;
    p->pan_button = XmCreateDrawnButton (form, "PanButton", al, ac );
/*
 * Create Select Button
 */
    ac = 0;
    XtSetArg(al[ac], XmNlabelType, XmPIXMAP); ac++;
    XtSetArg(al[ac], XmNlabelPixmap, p->select_pixmap); ac++;
    XtSetArg(al[ac], XmNshadowType, XmSHADOW_ETCHED_OUT); ac++;
    p->select_button = XmCreateDrawnButton (form, "SelectButton", al, ac );
/*
 * Create Horizontal Separator
 */
    ac = 0;
    sep1 = XmCreateSeparatorGadget (form, "PaletteSep1", al, ac);
/*
 * Create Vertical Flip Button
 */
    ac = 0;
    XtSetArg(al[ac], XmNlabelType, XmPIXMAP); ac++;
    XtSetArg(al[ac], XmNlabelPixmap, p->vflip_pixmap); ac++;
    XtSetArg(al[ac], XmNshadowType, XmSHADOW_ETCHED_OUT); ac++;
    p->vflip_button = XmCreateDrawnButton (form, "VFlipButton", al, ac );
/*
 * Create Horizontal Flip Button
 */
    ac = 0;
    XtSetArg(al[ac], XmNlabelType, XmPIXMAP); ac++;
    XtSetArg(al[ac], XmNlabelPixmap, p->hflip_pixmap); ac++;
    XtSetArg(al[ac], XmNshadowType, XmSHADOW_ETCHED_OUT); ac++;
    p->hflip_button = XmCreateDrawnButton (form, "HFlipButton", al, ac );
/*
 * Create Vertical Separator
 */
    ac = 0;
    XtSetArg(al[ac], XmNorientation, XmVERTICAL); ac++;
    sep2 = XmCreateSeparatorGadget (form, "PaletteSep2", al, ac );
/*
 * Create Rotate Right Button
 */
    ac = 0;
    XtSetArg(al[ac], XmNlabelType, XmPIXMAP); ac++;
    XtSetArg(al[ac], XmNlabelPixmap, p->rotate_r_pixmap); ac++;
    XtSetArg(al[ac], XmNshadowType, XmSHADOW_ETCHED_OUT); ac++;
    XtSetArg(al[ac], XmNnavigationType, XmTAB_GROUP); ac++;
    p->rotate_r_button = XmCreateDrawnButton (form, "RotateRButton", al, ac );
/*
 * Create Rotate Left Button
 */
    ac = 0;
    XtSetArg(al[ac], XmNlabelType, XmPIXMAP); ac++;
    XtSetArg(al[ac], XmNlabelPixmap, p->rotate_l_pixmap); ac++;
    XtSetArg(al[ac], XmNshadowType, XmSHADOW_ETCHED_OUT); ac++;
    XtSetArg(al[ac], XmNnavigationType, XmTAB_GROUP); ac++;
    p->rotate_l_button = XmCreateDrawnButton (form, "RotateLButton", al, ac );
/*
 * Create Rotate Spin Box
 */
    ac = 0;
    XtSetArg(al[ac], DtNspinBoxChildType, DtNUMERIC); ac++;
    XtSetArg(al[ac], DtNmaximumValue, 180); ac++;
    XtSetArg(al[ac], DtNminimumValue, 0); ac++;
    XtSetArg(al[ac], DtNposition, DEFAULT_ANGLE); ac++;
    XtSetArg(al[ac], XmNcolumns, 3); ac++;
    XtSetArg(al[ac], XmNshadowThickness, 0); ac++;
    p->rotate_value = DtCreateSpinBox (form, "RotateSpinBox", al, ac);
    XtVaGetValues (p->rotate_value, DtNtextField, &p->rotate_text, NULL);
    XmImUnregister (p->rotate_text);
/*
 * Create Degrees Label
 */
    ac = 0;
    XtSetArg(al[ac], XmNlabelType, XmPIXMAP); ac++;
    XtSetArg(al[ac], XmNlabelPixmap, p->degrees_pixmap); ac++;
    degrees_label = XmCreateLabel ( form, "DegreesLabel", al, ac );
/*
 * Create Rotate Scale
 */
    ac = 0;
    XtSetArg(al[ac], XmNmaximum, 180); ac++;
    XtSetArg(al[ac], XmNorientation, XmHORIZONTAL); ac++;
    XtSetArg(al[ac], XmNprocessingDirection, XmMAX_ON_RIGHT); ac++;
    XtSetArg(al[ac], XmNscaleMultiple, 1); ac++;
    XtSetArg(al[ac], XmNscaleWidth, 180); ac++;
    XtSetArg(al[ac], XmNvalue, DEFAULT_ANGLE); ac++;
    XtSetArg(al[ac], XmNshowValue, True); ac++; 
    XtSetArg(al[ac], XmNnavigationType, XmTAB_GROUP); ac++;
    p->rotate_scale = XmCreateScale (form, "RotateScale", al, ac );
/*
 * Create Zoom Button
 */
    ac = 0;
    XtSetArg(al[ac], XmNlabelType, XmPIXMAP); ac++;
    XtSetArg(al[ac], XmNlabelPixmap, p->zoom_pixmap); ac++;
    XtSetArg(al[ac], XmNshadowType, XmSHADOW_ETCHED_OUT); ac++;
    XtSetArg(al[ac], XmNnavigationType, XmTAB_GROUP); ac++;
    p->zoom_button = XmCreateDrawnButton (form, "ZoomButton", al, ac );
/*
 * Create Zoom Spin Box
 */
    ac = 0;
    XtSetArg(al[ac], DtNspinBoxChildType, DtNUMERIC); ac++;
    XtSetArg(al[ac], DtNmaximumValue, 400); ac++;
    XtSetArg(al[ac], DtNminimumValue, 25); ac++;
    XtSetArg(al[ac], DtNposition, DEFAULT_ZOOM); ac++;
    XtSetArg(al[ac], XmNcolumns, 3); ac++;
    XtSetArg(al[ac], XmNshadowThickness, 0); ac++;
    XtSetArg(al[ac], XmNnavigationType, XmTAB_GROUP); ac++;
    p->zoom_value = DtCreateSpinBox (form, "ZoomSpinBox", al, ac);
    XtVaGetValues (p->zoom_value, DtNtextField, &p->zoom_text, NULL);
    XmImUnregister (p->zoom_text);
/*
 * Create Zoom Scale
 */
    ac = 0;
    XtSetArg(al[ac], XmNminimum, 25); ac++;
    XtSetArg(al[ac], XmNmaximum, 400); ac++;
    XtSetArg(al[ac], XmNvalue, DEFAULT_ZOOM); ac++;
    XtSetArg(al[ac], XmNorientation, XmHORIZONTAL); ac++;
    XtSetArg(al[ac], XmNprocessingDirection, XmMAX_ON_RIGHT); ac++;
    XtSetArg(al[ac], XmNnavigationType, XmTAB_GROUP); ac++;
    XtSetArg(al[ac], XmNscaleMultiple, 1); ac++;
    XtSetArg(al[ac], XmNscaleWidth, 180); ac++;
    XtSetArg(al[ac], XmNshowValue, True); ac++;
    p->zoom_scale = XmCreateScale (form, "ZoomScale", al, ac );
/*
 * Create Percent Label
 */
    ac = 0;
    xmstrings[0] = XmStringCreateLocalized (catgets (prog->catd, 1, 146, "%"));
    XtSetArg(al[ac], XmNlabelString, xmstrings[0]); ac++;
    percent_label = XmCreateLabel ( form, "PercentLabel", al, ac );
    XmStringFree ( xmstrings [ 0 ] );
/*
 * Place Pan Button at top left.
 */
    ac = 0;
    XtSetArg(al[ac], XmNtopAttachment, XmATTACH_FORM); ac++;
    XtSetArg(al[ac], XmNleftAttachment, XmATTACH_FORM); ac++;
    XtSetValues ( p->pan_button,al, ac );
/*
 * Place Select Button under Pan Button
 */
    ac = 0;
    XtSetArg(al[ac], XmNtopAttachment, XmATTACH_WIDGET); ac++;
    XtSetArg(al[ac], XmNtopWidget, p->pan_button); ac++;
    XtSetArg(al[ac], XmNleftAttachment, XmATTACH_OPPOSITE_WIDGET); ac++;
    XtSetArg(al[ac], XmNleftOffset, 0); ac++;
    XtSetArg(al[ac], XmNleftWidget, p->pan_button); ac++;
    XtSetValues ( p->select_button,al, ac );
/*
 * Place Horizontal Separator under Select Button
 */
    ac = 0;
    XtSetArg(al[ac], XmNtopAttachment, XmATTACH_WIDGET); ac++;
    XtSetArg(al[ac], XmNtopWidget, p->select_button); ac++;
    XtSetArg(al[ac], XmNtopOffset, 10); ac++;
    XtSetArg(al[ac], XmNbottomAttachment, XmATTACH_NONE); ac++;
    XtSetArg(al[ac], XmNleftAttachment, XmATTACH_OPPOSITE_WIDGET); ac++;
    XtSetArg(al[ac], XmNleftOffset, 0); ac++;
    XtSetArg(al[ac], XmNleftWidget, p->select_button); ac++;
    XtSetArg(al[ac], XmNrightAttachment, XmATTACH_OPPOSITE_WIDGET); ac++;
    XtSetArg(al[ac], XmNrightOffset, 0); ac++;
    XtSetArg(al[ac], XmNrightWidget, p->select_button); ac++;
    XtSetValues (sep1,al, ac );
/*
 * Place Vertical Flip Button under Horizontal Separator
 */
    ac = 0;
    XtSetArg(al[ac], XmNtopAttachment, XmATTACH_WIDGET); ac++;
    XtSetArg(al[ac], XmNtopWidget, sep1); ac++;
    XtSetArg(al[ac], XmNtopOffset, 10); ac++;
    XtSetArg(al[ac], XmNleftAttachment, XmATTACH_OPPOSITE_WIDGET); ac++;
    XtSetArg(al[ac], XmNleftOffset, 0); ac++;
    XtSetArg(al[ac], XmNleftWidget, p->select_button); ac++;
    XtSetValues ( p->vflip_button,al, ac );
/*
 * Place Horizontal Flip Button under Vertical Flip Button
 */
    ac = 0;
    XtSetArg(al[ac], XmNtopAttachment, XmATTACH_WIDGET); ac++;
    XtSetArg(al[ac], XmNtopWidget, p->vflip_button); ac++;
    XtSetArg(al[ac], XmNtopOffset, 10); ac++;
    XtSetArg(al[ac], XmNbottomAttachment, XmATTACH_FORM); ac++;
    XtSetArg(al[ac], XmNleftAttachment, XmATTACH_OPPOSITE_WIDGET); ac++;
    XtSetArg(al[ac], XmNleftOffset, 0); ac++;
    XtSetArg(al[ac], XmNleftWidget, p->vflip_button); ac++;
    XtSetValues ( p->hflip_button,al, ac );
/*
 * Place Vertical Separator next to Pan Button and extend to
 * bottom of Horizontal Flip button 
 */
    ac = 0;
    XtSetArg(al[ac], XmNtopAttachment, XmATTACH_OPPOSITE_WIDGET); ac++;
    XtSetArg(al[ac], XmNtopOffset, 0); ac++;
    XtSetArg(al[ac], XmNtopWidget, p->pan_button); ac++;
    XtSetArg(al[ac], XmNleftAttachment, XmATTACH_WIDGET); ac++;
    XtSetArg(al[ac], XmNleftOffset, 10); ac++;
    XtSetArg(al[ac], XmNleftWidget, p->pan_button); ac++;
    XtSetArg(al[ac], XmNbottomAttachment, XmATTACH_OPPOSITE_WIDGET); ac++;
    XtSetArg(al[ac], XmNbottomOffset, 0); ac++;
    XtSetArg(al[ac], XmNbottomWidget, p->hflip_button); ac++;
    XtSetArg(al[ac], XmNrightAttachment, XmATTACH_NONE); ac++;
    XtSetValues ( sep2,al, ac );
/*
 * Place Rotate Right Button next to Vertical Separator
 */
    ac = 0;
    XtSetArg(al[ac], XmNtopAttachment, XmATTACH_OPPOSITE_WIDGET); ac++;
    XtSetArg(al[ac], XmNtopOffset, 0); ac++;
    XtSetArg(al[ac], XmNtopWidget, p->pan_button); ac++;
    XtSetArg(al[ac], XmNbottomAttachment, XmATTACH_NONE); ac++;
    XtSetArg(al[ac], XmNleftAttachment, XmATTACH_WIDGET); ac++;
    XtSetArg(al[ac], XmNleftWidget, sep2); ac++;
    XtSetArg(al[ac], XmNleftOffset, 10); ac++;
    XtSetArg(al[ac], XmNrightAttachment, XmATTACH_NONE); ac++;
    XtSetValues ( p->rotate_r_button,al, ac );
/*
 * Place Rotate Left Button next to Rotate Right Button
 */
    ac = 0;
    XtSetArg(al[ac], XmNtopAttachment, XmATTACH_OPPOSITE_WIDGET); ac++;
    XtSetArg(al[ac], XmNtopOffset, 0); ac++;
    XtSetArg(al[ac], XmNtopWidget, p->rotate_r_button); ac++;
    XtSetArg(al[ac], XmNbottomAttachment, XmATTACH_NONE); ac++;
    XtSetArg(al[ac], XmNleftAttachment, XmATTACH_WIDGET); ac++;
    XtSetArg(al[ac], XmNleftWidget, p->rotate_r_button); ac++;
    XtSetArg(al[ac], XmNrightAttachment, XmATTACH_NONE); ac++;
    XtSetValues ( p->rotate_l_button,al, ac );
/*
 * Place Rotate Spin Box next to Rotate Left Button 
 */
    ac = 0;
    XtSetArg(al[ac], XmNtopAttachment, XmATTACH_OPPOSITE_WIDGET); ac++;
    XtSetArg(al[ac], XmNtopOffset, 0); ac++;
    XtSetArg(al[ac], XmNtopWidget, p->rotate_l_button); ac++;
    XtSetArg(al[ac], XmNbottomAttachment, XmATTACH_NONE); ac++;
    XtSetArg(al[ac], XmNleftAttachment, XmATTACH_WIDGET); ac++;
    XtSetArg(al[ac], XmNleftWidget, p->rotate_l_button); ac++;
    XtSetArg(al[ac], XmNleftOffset, 10); ac++;
    XtSetArg(al[ac], XmNrightAttachment, XmATTACH_NONE); ac++;
    XtSetValues ( p->rotate_value, al, ac );
/*
 * Place Degrees Label next to Rotate Spin Box
 */
    ac = 0;
    XtSetArg(al[ac], XmNtopAttachment, XmATTACH_OPPOSITE_WIDGET); ac++;
    XtSetArg(al[ac], XmNtopOffset, 0); ac++;
    XtSetArg(al[ac], XmNtopWidget, p->rotate_value); ac++;
    XtSetArg(al[ac], XmNleftAttachment, XmATTACH_WIDGET); ac++;
    XtSetArg(al[ac], XmNleftWidget, p->rotate_value); ac++;
    XtSetArg(al[ac], XmNleftOffset, 0); ac++;
    XtSetArg(al[ac], XmNbottomAttachment, XmATTACH_NONE); ac++;
    XtSetArg(al[ac], XmNrightAttachment, XmATTACH_NONE); ac++;
    XtSetValues ( degrees_label, al, ac );
/*
 * Place Zoom Scale below Rotate Right Button 
 */
    ac = 0;
    XtSetArg(al[ac], XmNtopAttachment, XmATTACH_WIDGET); ac++;
    XtSetArg(al[ac], XmNtopWidget, p->rotate_r_button); ac++;
    XtSetArg(al[ac], XmNtopOffset, 5); ac++;
    XtSetArg(al[ac], XmNbottomAttachment, XmATTACH_NONE); ac++;
    XtSetArg(al[ac], XmNleftAttachment, XmATTACH_OPPOSITE_WIDGET); ac++;
    XtSetArg(al[ac], XmNleftOffset, 0); ac++;
    XtSetArg(al[ac], XmNleftWidget, p->rotate_r_button); ac++;
    XtSetArg(al[ac], XmNrightAttachment, XmATTACH_FORM); ac++;
    XtSetArg(al[ac], XmNrightOffset, 10); ac++;
    XtSetValues ( p->rotate_scale,al, ac );
/*
 * Place Zoom Button below Rotate Scale and next to 
 * Vertical Flip Button
 */
    ac = 0;
    XtSetArg(al[ac], XmNtopAttachment, XmATTACH_OPPOSITE_WIDGET); ac++;
    XtSetArg(al[ac], XmNtopWidget, p->vflip_button); ac++;
    XtSetArg(al[ac], XmNtopOffset, 0); ac++;
    XtSetArg(al[ac], XmNbottomAttachment, XmATTACH_NONE); ac++;
    XtSetArg(al[ac], XmNleftAttachment, XmATTACH_OPPOSITE_WIDGET); ac++;
    XtSetArg(al[ac], XmNleftOffset, 0); ac++;
    XtSetArg(al[ac], XmNleftWidget, p->rotate_r_button); ac++;
    XtSetArg(al[ac], XmNrightAttachment, XmATTACH_NONE); ac++;
    XtSetValues ( p->zoom_button,al, ac );
/*
 * Place Zoom Spin Box next to Zoom Button 
 */
    ac = 0;
    XtSetArg(al[ac], XmNtopAttachment, XmATTACH_OPPOSITE_WIDGET); ac++;
    XtSetArg(al[ac], XmNtopOffset, 0); ac++;
    XtSetArg(al[ac], XmNtopWidget, p->zoom_button); ac++;
    XtSetArg(al[ac], XmNbottomAttachment, XmATTACH_NONE); ac++;
    XtSetArg(al[ac], XmNleftAttachment, XmATTACH_WIDGET); ac++;
    XtSetArg(al[ac], XmNleftWidget, p->zoom_button); ac++;
    XtSetArg(al[ac], XmNleftOffset, 10); ac++;
    XtSetArg(al[ac], XmNrightAttachment, XmATTACH_NONE); ac++;
    XtSetValues ( p->zoom_value, al, ac );
/*
 * Place Percent Label next to Zoom Spin Box
 */
    ac = 0;
    XtSetArg(al[ac], XmNtopAttachment, XmATTACH_OPPOSITE_WIDGET); ac++;
    XtSetArg(al[ac], XmNtopOffset, 0); ac++;
    XtSetArg(al[ac], XmNtopWidget, p->zoom_value); ac++;
    XtSetArg(al[ac], XmNleftAttachment, XmATTACH_WIDGET); ac++;
    XtSetArg(al[ac], XmNleftWidget, p->zoom_value); ac++;
    XtSetArg(al[ac], XmNleftOffset, 0); ac++;
    XtSetArg(al[ac], XmNbottomAttachment, XmATTACH_NONE); ac++;
    XtSetArg(al[ac], XmNrightAttachment, XmATTACH_NONE); ac++;
    XtSetValues ( percent_label, al, ac );
/*
 * Place Zoom Scale below Zoom Button
 */
    ac = 0;
    XtSetArg(al[ac], XmNtopAttachment, XmATTACH_WIDGET); ac++;
    XtSetArg(al[ac], XmNtopWidget, p->zoom_button); ac++;
    XtSetArg(al[ac], XmNtopOffset, 5); ac++;
    XtSetArg(al[ac], XmNbottomAttachment, XmATTACH_NONE); ac++;
    XtSetArg(al[ac], XmNleftAttachment, XmATTACH_OPPOSITE_WIDGET); ac++;
    XtSetArg(al[ac], XmNleftOffset, 0); ac++;
    XtSetArg(al[ac], XmNleftWidget, p->zoom_button); ac++;
    XtSetArg(al[ac], XmNrightAttachment, XmATTACH_FORM); ac++;
    XtSetArg(al[ac], XmNrightOffset, 10); ac++;
    XtSetValues ( p->zoom_scale,al, ac );
/*
 * Create Revert Button
 */
    ac = 0;
    xmstrings[0] = XmStringCreateLocalized (catgets (prog->catd, 1, 147, 
						     "Revert"));
    XtSetArg(al[ac], XmNlabelString, xmstrings[0]); ac++;
    p->revert_button = XmCreatePushButton (p->dialog, "PaletteRevertButton", 
					   al, ac );
    XmStringFree ( xmstrings [ 0 ] );
/*
 * Create Cancel Button
 */
    ac = 0;
    xmstrings[0] = XmStringCreateLocalized (catgets (prog->catd, 1, 148, 
						     "Close"));
    XtSetArg(al[ac], XmNlabelString, xmstrings[0]); ac++;
    p->cancel_button = XmCreatePushButton (p->dialog, "PaletteCancelButton", 
					   al, ac );
    XmStringFree ( xmstrings [ 0 ] );
/*
 * Create Help Button
 */
    ac = 0;
    xmstrings[0] = XmStringCreateLocalized (catgets (prog->catd, 1, 149, 
						     "Help"));
    XtSetArg(al[ac], XmNlabelString, xmstrings[0]); ac++;
    p->help_button = XmCreatePushButton ( p->dialog, "PaletteHelpButton", 
					 al, ac );
    XmStringFree ( xmstrings [ 0 ] );
/*
 * Set Revert button to be the default button
Note: Can't do this because Revert will be activated when user hits return
in spin button text fields.
        XtVaSetValues (p->dialog, XmNdefaultButton, p->revert_button, NULL);
 */
    p->showing = False;
/*
 * Set help callback on dialog
 */
    XtAddCallback (p->dialog, XmNhelpCallback, HelpItemCallback, 
		   HELP_PALETTE_ITEM);
/*
 * Set callbacks on buttons
 */
    XtAddCallback (p->pan_button, XmNactivateCallback, PanCallback, p);
    XtAddCallback (p->select_button, XmNactivateCallback, SelectCallback, p);
    
    XtAddCallback (p->vflip_button, XmNarmCallback, VflipCallback, p);
    XtAddCallback (p->vflip_button, XmNactivateCallback, VflipCallback, p);
    XtAddCallback (p->hflip_button, XmNarmCallback, HflipCallback, p);
    XtAddCallback (p->hflip_button, XmNactivateCallback, HflipCallback, p);
    
    XtAddCallback (p->rotate_r_button, XmNarmCallback, RotateCallback, p);
    XtAddCallback (p->rotate_r_button, XmNactivateCallback, RotateCallback, p);
    XtAddCallback (p->rotate_l_button, XmNarmCallback, RotateCallback, p);
    XtAddCallback (p->rotate_l_button, XmNactivateCallback, RotateCallback, p);
    
    XtAddCallback (p->rotate_text, XmNmodifyVerifyCallback, 
		   RotateValueCallback, p);
    XtAddCallback (p->rotate_text, XmNactivateCallback, 
		   RotateValueCallback, p);
    XtAddCallback (p->rotate_text, XmNvalueChangedCallback,
		   RotateValueCallback, p);
    
    XtAddCallback (p->rotate_scale, XmNdragCallback, 
		   RotateScaleCallback, p);
    XtAddCallback (p->rotate_scale, XmNvalueChangedCallback, 
		   RotateScaleCallback, p);
    
    XtAddCallback (p->zoom_button, XmNarmCallback, ZoomCallback, p);
    XtAddCallback (p->zoom_button, XmNactivateCallback, ZoomCallback, p);
    
    XtAddCallback (p->zoom_text, XmNmodifyVerifyCallback, 
		   ZoomValueCallback, p);
    XtAddCallback (p->zoom_text, XmNactivateCallback, 
		   ZoomValueCallback, p);
    XtAddCallback (p->zoom_text, XmNvalueChangedCallback,
		   ZoomValueCallback, p);
    
    XtAddCallback (p->zoom_scale, XmNdragCallback, 
		   ZoomScaleCallback, p);
    XtAddCallback (p->zoom_scale, XmNvalueChangedCallback, 
		   ZoomScaleCallback, p);
    
    XtAddCallback (p->revert_button, XmNactivateCallback, 
		   RevertCallback, p);
    XtAddCallback (p->cancel_button, XmNactivateCallback, 
		   PaletteCancelCallback, p);
    XtAddCallback (p->help_button, XmNactivateCallback, HelpItemCallback, 
		   HELP_PALETTE_ITEM);
/*
 * Manage the children
 */
    ac = 0;
    children[ac++] = p->pan_button;
    children[ac++] = p->select_button;
    children[ac++] = sep1;
    children[ac++] = p->vflip_button;
    children[ac++] = p->hflip_button;
    children[ac++] = sep2;
    children[ac++] = p->rotate_r_button;
    children[ac++] = p->rotate_l_button;
    children[ac++] = p->rotate_value;
    children[ac++] = p->rotate_scale;
    children[ac++] = degrees_label;
    children[ac++] = p->zoom_button;
    children[ac++] = p->zoom_value;
    children[ac++] = p->zoom_scale;
    children[ac++] = percent_label;
    XtManageChildren(children, ac);
    ac = 0;
    children[ac++] = form;
    children[ac++] = p->revert_button;
    children[ac++] = p->cancel_button;
    children[ac++] = p->help_button;
    XtManageChildren(children, ac);
    
    cursor = CursorObjectsInitialize (base->top_level);
    
    return p;
}

/*
 * Initialize an instance of object `cursor'.
 */
CursorObjects *
CursorObjectsInitialize (parent)
     Widget    parent;
{
     XColor          fg, bg;
     Pixmap          src_pixmap, mask_pixmap;
     Display        *display;
     XID             xid;
     Colormap        cmap;
     CursorObjects  *c;

     c = (CursorObjects *) calloc(1, sizeof (CursorObjects));
     display = XtDisplay (parent);
     xid     = XtWindow (parent);
/* 
 * Create mask and source pixmaps for Pan Cursor
 */
     mask_pixmap = XCreateBitmapFromData (display, xid, 
					  (char *) (pan_cursor_xbm_bits),
					  pan_cursor_xbm_width,
					  pan_cursor_xbm_height);
     src_pixmap = XCreateBitmapFromData (display, xid, 
					  (char *) (pan_cursor_mask_xbm_bits),
					  pan_cursor_mask_xbm_width,
					  pan_cursor_mask_xbm_height);
     fg.flags = bg.flags = DoRed | DoGreen | DoBlue;
     fg.pixel = BlackPixel (display, DefaultScreen (display));
     XtVaGetValues (parent, XmNcolormap, &cmap, NULL);
     XQueryColor (display, cmap, &fg);
     bg.pixel = WhitePixel (display, DefaultScreen (display));
     XQueryColor (display, cmap, &bg);
					  
     c->pan_cursor = XCreatePixmapCursor (display, src_pixmap, mask_pixmap,
					  &fg, &bg, 8, 8);
     XFreePixmap (display, src_pixmap);
     XFreePixmap (display, mask_pixmap);

     return c;
}
