# %%  (c) Copyright 1993, 1994 Hewlett-Packard Company			
# %%  (c) Copyright 1993, 1994 International Business Machines Corp.	
# %%  (c) Copyright 1993, 1994 Sun Microsystems, Inc.			
# %%  (c) Copyright 1993, 1994 Novell, Inc. 				
# %%  $Revision: $ 			 				
# @(#)simple.mk	1.8 93/09/07

TT_DIR	= ../..

all:	tt_type_comp

include $(TT_DIR)/simple-macros.mk

TT_TYPE_COMP_OBJECTS =\
mp_type_comp.o \
mp_types_table.o \
mp_types_gram.o \
mp_types_lex.o

tt_type_comp:	$(TT_TYPE_COMP_OBJECTS) $(LDSDEP)
	$(CCC) $(CCCFLAGS) $(LDSCCCFLAGS) -o tt_type_comp \
	$(TT_TYPE_COMP_OBJECTS) $(LDSCCCLIBS)

mp_type_comp.o:	mp_type_comp.C
	$(CCC) $(CCCFLAGS) -I$(TT_DIR)/slib $(VEROPT) \
	-o mp_type_comp.o -c mp_type_comp.C

mp_types_table.o:	mp_types_table.C
	$(CCC) $(CCCFLAGS) -I$(TT_DIR)/slib \
	-o mp_types_table.o -c mp_types_table.C

mp_types_gram.o:	mp_types_gram.C
	$(CCC) $(CCCFLAGS) -I$(TT_DIR)/slib \
	-o mp_types_gram.o -c mp_types_gram.C

mp_types_lex.o:	mp_types_lex.C mp_types_gram.h
	$(CCC) $(CCCFLAGS) -I$(TT_DIR)/slib \
	-o mp_types_lex.o -c mp_types_lex.C

# We generate C code via lex and yacc, then turn it into C++
# via sed scripts.  This is highly dependent on the details
# of the code generated by lex and yacc, so it tends to break
# on every platform but Solaris.  Since this really only
# needs to be done when the grammar or lexical definition changes,
# we ship "frozen" yacc/lex output which is what we usually compile.
# The yacc/lex statements can be found later on, commented out.

mp_types_gram.C: frozen.mp_types_gram.C
	cp frozen.mp_types_gram.C mp_types_gram.C

mp_types_gram.h: frozen.mp_types_gram.h
	cp frozen.mp_types_gram.h mp_types_gram.h

mp_types_lex.C: frozen.mp_types_lex.C
	cp frozen.mp_types_lex.C mp_types_lex.C

mp_types_lex.h: frozen.mp_types_lex.h
	cp frozen.mp_types_lex.h mp_types_lex.h

#mp_types_gram.C + mp_types_gram.h : mp_types_gram.y
#	$(YACC) -d mp_types_gram.y
#	sed 's/^\([int]*[ ]*\)yyparse(/\1_Tt_types_table::yyparse(/' y.tab.c > mp_types_gram.C
#	$(RM) y.tab.c
#	mv y.tab.h mp_types_gram.h
#
#mp_types_lex.C : mp_types_lex.l mp_types_gram.h
#	$(LEX) mp_types_lex.l | sed -e '/^# define output/d' -e '/^# define input/d' -e '/^# define unput/d' -e 's/^yylex()/int _Tt_types_table::yylex()/' -e 's/^[int]*[ ]*yylook(/int _Tt_types_table::yylook(/' -e 's/^[int]*[ ]*yyback(/int _Tt_types_table::yyback(/' -e 's/(p, m)/(int *p, int m)/' -e 's/lex_input/input/' -e 's/lex_output/output/' -e '/^	int \*p;/ d' -e '/lex library/ q' > mp_types_lex.C
#

clean:
	$(RM) tt_type_comp $(TT_TYPE_COMP_OBJECTS) \
	mp_types_gram.C mp_types_gram.h mp_types_lex.C

install: tt_type_comp
	@test -d $(INSTALLBIN) || mkdir -p $(INSTALLBIN)
	$(RM) $(INSTALLBIN)/tt_type_comp; cp tt_type_comp $(INSTALLBIN); chmod 555 $(INSTALLBIN)/tt_type_comp

